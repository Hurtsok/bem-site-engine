bem-engine
========

Платформа для создания сайтов с документацией.

В настоящее время на базе данной платформы созданы и работают следующие сайты:

* [Bem-Info](http://bem.info)
* [Лего-Сайт](http://lego.yandex-team.ru)

Установка и сборка данных
------

### Клонируем репозиторий
```
$ git clone git://github.yandex-team.ru/bem/bem-engine.git
$ cd bem-engine
```

### Собираем в dev-режиме
```
$ make
$ make data
```

### Собираем в test-режиме
```
$ YENV=test make
$ make data YENV=test
```

### Собираем в production-режиме
```
$ YENV=production make
$ make data_prod YENV=production version=latest
```

Запуск
------

```
$ npm start
```

Чтобы заработали поддомены необходимо добавить в `/etc/hosts` записи:

```
127.0.0.1    localhost
127.0.0.1    ru.localhost
127.0.0.1    en.localhost
```

### Организация и версионирование собранных данных

При каждом запуске данные собранные в файлы `data.json` и `marker.json` помещаются в папку
однозначно идентифицирующую версию данных, например `snapshot_9:4:2014-18:40:14`.

Для `development` окружения эти сборки помещаются в папку `backups`, а рабочие файлы `data.json` и `marker.json`
т.е. файлы данные из которых загружаются при старте приложения в `development` режиме лежат в корне директории `backups`.

Для `testing` и `production` окружений предусмотрена следующая схема.
Папки с версиями данных собираются и загружаются на Yandex Disk в папки идентифицирующие конкретные приложения, например
`bem-info` или `lego-site`. При этом внутри каждой папки `bem-info` или `lego-site` лежат директории с именами,
совпадающие с названиями окружений: `testing` и `production` в которые помещаются файлы `data.json` и `marker.json`,
данные из которых берутся при работе приложения в режимах `testing` и `production` соответственно.

Сборка данных для `development` окружения осуществляется командой `make data` или `make data YENV=dev`.
Сборка данных для `testing` окружения осуществляется командой `make data YENV=testing`.
Сборка данных для `production` окружения осуществляется командой `make data YENV=production`.

ВНИМАНИЕ: Не рекомендуется делать "прямую" сборку данных для `production` окружения!

Вместо этого рекомендуется делать копирование собранных данных, которые уже протестированы например в `testing` окружении
в `production`. Для этого нужно запустить сборку данных с указанием версии данных, напрмер:

```
$ make data_prod YENV=production version=latest
```

При выполнении этой команды вместо новой полной сборки данных будет осуществлено копирование файлов `data.json` и `marker.json`
из папки `snapshot_*` где под `*` понимается дата последней (или новейшей) по времени сборки данных в папку `production`.

Возможные значения для парамера `version`:

* `0` или `latest` - копирование последней версии собранных данных в папку совпадающую с назанием окружения, указанного в парамере `YENV`
* `-1` или `previous` - копирование предпоследней версии собранных данных в папку совпадающую с назанием окружения, указанного в парамере `YENV`
* `-n` (где `n` может принимать любое число от 1 и выше) - откат версии для окружения `YENV` на `n` шагов назад.
* полное название конкретной версии собранных данных, например `snapshot_9:4:2014-18:40:14`

Ответственные за разработку:

@bemer
@tavria
@tadatuta
@blond
@dmytry