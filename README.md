bem-info
========

Сайт про БЭМ. 

Сборка
------

```sh
# Клонируем
$ git clone git://github.yandex-team.ru/lego/bem-info.git
$ cd bem-info

# Собираем в dev-режиме
$ make
$ make data

# Собираем в production-режиме
$ YENV=production make
$ YENV=production make data
```

Запуск
------

```sh
$ npm start
```

Чтобы заработали поддомены необходимо добавить в `/etc/hosts` записи:

```
127.0.0.1    localhost
127.0.0.1    ru.localhost
127.0.0.1    en.localhost
```

### Принцип сборки данных и построения модели:

На сайт собираются данные трех типов:

* Документация (статьи, документация к инструмента, новости и.т.д)
* Библиотеки блоков
* Информация по людям

Для каждого из этих типов данных предусмотрен свой сценарий загрузки.

Структура сайта собирается путем подключения скриптов, которые находятся в папке `/model`. Все
`*.js` файлы, которые там находятся имеют логичную и консистентную компоновку. Их расположение отражает структуру сайта.
Данные крипты в совокупности возвращают объект - модель сайта с включенной мета-информацией для узлов, имеющих ресурсы, а также
ссылки на `*.md` файлы документации.

При запуске `$ make sitemap_compiler` выполняются следующие действия:

* Сборка модели сайта из подключенных фалов `/model`
* Анализ и дополнение мета-информации для узлов имеющих связанные ресурсы
* Анализ узлов на наличие связанных библиотек блоков
* Загрузка и парсинг `*.md` файлов через github API.
* Загрузка и парсинг собранных данных по библиотекам блоков
* Загрузка и парсинг данных по людям через github API
* Сборка уникальных ключей авторов, переводчиков и тегов
* Сохранение модели сайта, документации, данных по людям и данных о библиотеках блоков в файлы
`sitemap.json`, `docs.json`, `people.json` и `libraries.json` соответственно.
* Вычисление хеш сум от содержимого файлов `sitemap.json`, `docs.json`, `people.json` и `libraries.json` и
запись в файл `marker.json`, изменение которого отслеживается запущенным приложением.

ПРИМЕЧАНИЕ: При запуске в dev - режиме происходит сохранение на локальную файловую систему.
При запуске в production - режиме происходит загрука собранных `*.json` файлов на Яндекс Диск.

При запуске сервера происходит считывание файлов `sitemap.json`, `docs.json`, `people.json` и `libraries.json`
с локальной файловой систем или Яндекс Диска в зависимости от выставленого окружения.

Меню для разделов авторов, тегов и библиотек блоков выстраивается динамически по загруженным данным.

![Схема загрузки данных](docs/make_data.png?raw=true)

Ответственные за разработку:

@bemer
@blond
@tavria
@sipayrt
@tadatuta
@dmytry