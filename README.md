bem-info
========

Сайт про БЭМ. 

Сборка
------

```sh
# Клонируем
$ git clone git://github.yandex-team.ru/lego/bem-info.git
$ cd bem-info

# Собираем в dev-режиме
$ make
$ make sitemap_compiler

# Собираем в production-режиме
$ YENV=production make
$ YENV=production sitemap_compiler
```

Запуск
------

```sh
$ npm start
```

Чтобы заработали поддомены необходимо добавить в `/etc/hosts` записи:

```
127.0.0.1    localhost
127.0.0.1    ru.localhost
127.0.0.1    en.localhost
```

### Принцип сборки данных и построения модели:

На сайт собираются данные трех типов:

* Документация (статьи, документация к инструмента, новости и.т.д)
* Библиотеки блоков
* Информация по людям

Для каждого из этих типов данных предусмотрен свой сценарий загрузки.

Структура сайта собирается путем подключения скриптов, которые находятся в папке `/model`. Все
`*.js` файлы, которые там находятся имеют логичную и консистентную компоновку. Их расположение отражает структуру сайта.
Данные крипты в совокупности возвращают объект - модель сайта с включенной мета-информацией для узлов, имеющих ресурсы, а также
ссылки на `*.md` файлы документации.

При запуске `$ make sitemap_compiler` выполняются следующие действия:

* сборка модели сайта из подключенных фалов `/model`
* анализ и дополнение мета-информации для узлов имеющих связанные ресурсы
* Загрузка и парсинг `*.md` файлов через github API.
* Сборка уникальных ключей авторов, переводчиков и тегов
* Сохранение модели сайта и документации в файлы `docs.json` и `sitemap.json`

** Примечание **: При запуске в dev - режиме происзодит сохранение на локальную файловую систему.
При запуске в production - режиме происходит загрука собранных `*.json` файлов на Яндекс Диск.

При запуске сервера происходит считывание файлов `docs.json` и `sitemap.json` с локальной файловой систем или Яндекс Диска в
завичимости от выставленого окружения.

Библиотеки блоков загружаются при старте сервера c гитхаба через https запросы, так как их размер превышает допустимый для использования github API.

Информация по людям загружается напрямую с гитхаба при старте сервера через github API.

Меню для разделов авторов, тегов и библиотек блоков выстраивается динамически по загруженным данным.

Ответственные за разработку:

@bemer
@blond