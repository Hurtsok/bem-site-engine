block post, mod view full {

    content: {
        var source = this.data.node.source[this.data.req.prefLocale],
            node = this.data.node;

        if(!source) {
            logger.error('source not found for node %s and locale %s', this.data.node.id, this.data.req.prefLocale);
            return [];
        }

        return [

            apply('date', this.ctx = {
                createDate: source.createDate,
                editDate: source.editDate
            }),

            apply('author', this.ctx = {
                authors: source.authors,
                translators: source.translators
            }),

            apply('categories', this.ctx = {
                breadcrumbs: this.data.node.breadcrumbs,
                lang: this.data.lang
            }),

            apply('title-tags', this.ctx.content = source),
            apply('contentFull', this.ctx.content = source.content),
            apply('issue', this.ctx.content = source.repo)
        ];
    }

    //authors of post
    author: {
        elem: 'author',
        authors: this.ctx.authors,
        translators: this.ctx.translators
    }

    //date of creation and last modification
    date: {
        var ctx = this.ctx,
            createDate = ctx.createDate,
            editDate = ctx.editDate;

        if(createDate || editDate) {
            return {
                elem: 'date',
                elemMods: { type: 'human' },
                createDate: createDate,
                editDate: editDate
            }
        }
    }

    //post categories
    categories: {
        elem: 'categories',
        breadcrumbs: this.ctx.breadcrumbs,
        lang: this.ctx.lang
    }

    //post title + tags array of post
    title-tags: {

        var content = this.ctx.content,
            tags = content.tags;

        if(tags) {
            return {
                elem: 'title-line',
                content: [
                    {
                        elem: 'title',
                        tag: 'h1',
                        content: content.longTitle || content.title
                    },
                    {
                        elem: 'tags',
                        content: tags
                    }
                ]
            }
        }

        return {
            elem: 'title',
            tag: 'h1',
            content: content.longTitle || content.title
        }
    }

    //post content
    contentFull: {
        elem: 'content',
        url: apply('getUrl'),
        content: this.ctx.content
    }

    issue: {
        var repo = this.ctx.content;

        if(!repo) return [];

        var issueContent = [
            {
                tag: 'span',
                content: BEM.I18N('post', 'repo-text')
            },
            {
                block: 'link',
                url: repo.issue,
                content: BEM.I18N('post', 'repo-issue')
            },
            {
                tag: 'span',
                content: BEM.I18N('post', 'repo-on-github')
            }
        ];

        issueContent = repo.type === 'public' ? issueContent.concat([
            {
                tag: 'span',
                content: BEM.I18N('post', 'repo-alternative')
            },
            {
                block: 'link',
                url: repo.prose,
                content: BEM.I18N('post', 'repo-prose')
            },
            {
                tag: 'span',
                content: BEM.I18N('post', 'repo-with-prose')
            }
        ]) : issueContent;


        return {
            elem: 'issue',
            content: issueContent
        }
    }

    getUrl: {
        var lang = this.data.req.prefLocale == 'en' ? 'ru' : 'en',
            host = this.data.req.headers.host,
            path = this.data.req._parsedUrl.pathname;

            return 'http://' + lang +
                (host.indexOf(this.data.req.prefLocale) == 0 ? host.slice(host.indexOf('.')) : ('.' + host)) + path;
    }
}

